---
import ErrorAlert from "@components/alerts/errorAlert.astro";
import SuccessAlert from "@components/alerts/successAlert.astro";
import MainNav from "@layouts/MainNav.astro";
import {
  GhostCreateFolderIcon,
  CollapseAllIcon,
  SpinnerIcon,
} from "@lib/icons";

interface Props {
  message?: AlertMessage;
}

const { message } = Astro.props;
const { playlistId, itemId, questionId } = Astro.locals.params;
---

<MainNav>
  <ul
    class="bg-neutral menu row-span-full flex-nowrap col-span-3 overflow-y-auto menu-vertical border-r border-base-100"
  >
    <li
      hx-get={`/dashboard/files?playlistId=${playlistId}&itemId=${itemId}&questionId=${questionId}`}
      hx-trigger="load"
      hx-swap="afterend"
      hx-select=".item"
      id="treeRoot"
    >
      <ul
        class="menu menu-horizontal relative [&_li>a]:p-1 [&_li>a]:text-lg gap-1 flex justify-end"
      >
        <li class="text-left m-auto ml-0 capitalize font-semibold">
          dashboard
        </li>
        <li>
          <a
            hx-post="/dashboard/files"
            hx-swap="afterend"
            hx-target="#treeRoot"
            hx-select=".item"
          >
            <GhostCreateFolderIcon />
          </a>
        </li>
        <li>
          <a
            id="collapseAll"
            href="/dashboard"
            hx-select="#dashboard-content"
            hx-target="#dashboard-content"
            hx-swap="outerHTML"
          >
            <CollapseAllIcon />
          </a>
        </li>
      </ul>
    </li>
  </ul>
  <main
    class="bg-neutral row-span-full col-span-9 overflow-x-hidden overflow-y-auto"
  >
    <div id="dashboard-content" class="grid grid-cols-1">
      <slot />
      {
        message?.show && message.type === "success" && (
          <SuccessAlert message={message} />
        )
      }
      {
        message?.show && message.type === "error" && (
          <ErrorAlert message={message} />
        )
      }
    </div>
  </main>

  <script>
    const collapseDetails = () => {
      const details = document.querySelectorAll<HTMLDetailsElement>(".detail");
      details.forEach((detail) => {
        detail.open = false;
      });
    };

    window.onload = () => {
      document
        .getElementById("collapseAll")
        ?.addEventListener("click", collapseDetails);
    };
  </script>
</MainNav>
