---
import axios from "axios";
import { CreateFileIcon, FileIcon, FolderIcon } from "../../../lib/icons";
import UD from "../../../components/UD.astro";
const url = new URL(Astro.request.url);
const pb_loc = import.meta.env.PB_LOCATION;

const res = await axios.get(
  `${pb_loc}/api/collections/item/records${url.search}`
);

const items = res.data.items;
---

{
  items.map((item: Item) => {
    return (
      <li class="item">
        <details>
          <summary>
            <FolderIcon />
            {item.title}
          </summary>
          <UD />
          <ul>
            <li>
              <a>
                <FileIcon />
                article.md
              </a>
            </li>
            <li
              hx-get={`/api/files/questions?filter=item = "${item.id}"`}
              hx-swap="innerHTML"
              hx-target={`#questions-${item.id}`}
              hx-select=".question"
              hx-trigger="click once"
            >
              <details>
                <summary>
                  <FolderIcon />
                  questions
                </summary>
                <ul class="menu menu-horizontal py-0">
                  <li class="text-success">
                    <a>
                      <CreateFileIcon />
                    </a>
                  </li>
                </ul>
                <ul id={`questions-${item.id}`} />
              </details>
            </li>
          </ul>
        </details>
      </li>
    );
  })
}
