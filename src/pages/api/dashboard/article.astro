---
import Editor from "../../../components/Editor";
import type { itemType } from "../../../../types/database";
import axios from "axios";
const origin = import.meta.env.API_URL;

const { url } = Astro.request;
const newUrl = new URL(url);

let data: any = {};

try {
  const res = await axios.get(`${origin}/api/items.json${newUrl.search}`);
  data = res.data[0] as itemType;
} catch (error) {
  console.log(error);
}

const save = async (editor: any, id: any) => {
  await fetch("/api/items.json", {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      content: editor.getData(),
      id,
    }),
  });
};
---

<Editor
  client:only
  content={data.content}
  saveContent={save.toString()}
  saveParams={[data.id]}
/>
